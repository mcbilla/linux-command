top
===

显示系统的运行状态和进程信息

## 补充说明

top命令是Linux系统中最常用的命令之一，它可以显示系统的运行状态和进程信息，以及一些关于资源利用率的摘要信息，包括CPU和内存的使用情况。top命令提供了一个动态的实时视图，可以随时更新和刷新。top命令的全称是table of processes，意思是进程表。

## 适用的Linux版本

top命令适用于大多数Linux发行版，如Ubuntu、Debian、Fedora、CentOS等。不同的发行版可能会有一些细微的差异，例如显示的字段和选项。要查看top命令的版本，可以使用以下命令：

```bash
$ top -v
```

## 基本语法

要运行top命令，只需要在终端中输入以下命令并按回车键：

```bash
$ top
```

top命令会进入交互式模式，显示当前活动的进程和其他系统信息。你可以使用一些可用的选项和快捷键来自定义视图。

## Linux top命令的常用选项说明

| 选项             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| -h, --help       | 显示帮助信息，然后退出程序                                   |
| -v, --version    | 显示库版本和使用提示，然后退出程序                           |
| -b, --batch      | 启动批处理模式，允许将top命令的输出发送到文件或其他程序。在批处理模式下，top不接受输入，并且运行直到被杀死或达到指定的迭代次数 |
| -c, --command    | 切换显示命令行或程序名。如果上次记住的状态是显示命令行，则该字段现在显示程序名，反之亦然 |
| -d, --delay      | 指定刷新屏幕之前的延迟时间，覆盖默认值。该值以秒为单位。该命令接受小数秒，但不接受负数。或是在交谈式指令列( interactive command)按 s |
| -e, --kibibytes  | 切换内存单位为kibibytes（1024字节），而不是默认的mebibytes（1048576字节） |
| -H, --threads    | 显示单个线程而不是每个进程的所有线程之和。linux 中的线程和进程使用相同的数据结构，所以每个线程也有单独的PID。或是在交谈式指令列( interactive command)按 H。 |
| -i, --idle       | 切换显示空闲进程。当该选项关闭时，top不显示自上次更新以来没有使用CPU资源的进程 |
| -n, --iterations | 指定top产生的最大迭代次数，在达到该次数后退出程序            |
| -o, --sort-key   | 指定top用于排序进程的字段名。在字段名前加上+号强制top按照从高到低的顺序排序，加上-号则按照从低到高的顺序排序 |
| -p, --pid        | 指定要监视的一个或多个进程ID（PID），用逗号分隔。只有指定的进程会被显示 |
| -u, --user       | 指定要监视的一个或多个用户名或用户ID（UID），用逗号分隔。只有属于指定用户的进程会被显示 |
| -w, --width      | 指定屏幕宽度，覆盖默认值                                     |

**交互窗口下的操作指令：**

- **P：按%CPU使用率排行**
- **T：按MITE+排行**
- **M：按%MEM排行**
- 数字键1：监控每个逻辑CPU的状况
- <Space>：立即刷新
- s：设置刷新时间间隔
- c：显示命令完全模式
- t:：显示或隐藏进程和CPU状态信息
- m：显示或隐藏内存状态信息
- l：显示或隐藏uptime信息
- f：增加或减少进程显示标志
- S：累计模式，会把已完成或退出的子进程占用的CPU时间累计到父进程的MITE+
- u：指定显示用户进程
- r：修改进程renice值
- k：kill 进程
- i：只显示正在运行的进程
- W：保存对top的设置到文件^/.toprc，下次启动将自动调用toprc文件的设置。
- h：帮助命令。
- q：退出
- E：切换顶部的内存信息大小单位，每次切换转换率为1000，切换的单位为 k,m,g,t,p。
- e：切换底部的进程的内存信息，切换规则同E

注意：

- 使用频率最高的是P、T、M，因为通常使用top，我们就想看看是哪些进程最耗cpu资源、占用的内存最多
- 通过 `shift + >` 或 `shift + <` 可以向右或左改变排序列
- 如果只需要查看内存，可用 `free` 命令
- 如果只查看uptime信息（第一行），可用 `uptime` 命令

## 示例

### 查看系统摘要信息

```bash
$ top
```

这个命令会显示系统的摘要信息

```bash
top - 09:14:56 up 264 days, 20:56,  1 user,  load average: 0.02, 0.04, 0.00
Tasks:  87 total,   1 running,  86 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.0%us,  0.2%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.2%st
Mem:    377672k total,   322332k used,    55340k free,    32592k buffers
Swap:   397308k total,    67192k used,   330116k free,    71900k cached
    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
    1 root      20   0  2856  656  388 S  0.0  0.2   0:49.40 init
    2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd
    3 root      20   0     0    0    0 S  0.0  0.0   7:15.20 ksoftirqd/0
    4 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 migration/0
```

- 第一行
  - 09:14:56 ： 系统当前时间
  - 264 days, 20:56 ： 系统开机到现在经过了多少时间
  - 1 users ： 当前2用户在线
  - load average: 0.02, 0.04, 0.00： 系统1分钟、5分钟、15分钟的CPU负载信息
- 第二行
  - Tasks：任务;
  - 87 total：很好理解，就是当前有87个任务，也就是87个进程。
  - 1 running：1个进程正在运行
  - 86 sleeping：86个进程睡眠
  - 0 stopped：停止的进程数
  - 0 zombie：僵死的进程数
- 第三行
  - Cpu(s)：表示这一行显示CPU总体信息
  - 0.0%us：用户态进程占用CPU时间百分比，不包含renice值为负的任务占用的CPU的时间。
  - 0.7%sy：内核占用CPU时间百分比
  - 0.0%ni：改变过优先级的进程占用CPU的百分比
  - 99.3%id：空闲CPU时间百分比
  - 0.0%wa：等待I/O的CPU时间百分比
  - 0.0%hi：CPU硬中断时间百分比
  - 0.0%si：CPU软中断时间百分比
  - 注：这里显示数据是所有cpu的平均值，如果想看每一个cpu的处理情况，按1即可；折叠，再次按1；
- 第四行
  - Men：内存的意思
  - 8175320kk total：物理内存总量
  - 8058868k used：使用的物理内存量
  - 116452k free：空闲的物理内存量
  - 283084k buffers：用作内核缓存的物理内存量
- 第五行
  - Swap：交换空间
  - 6881272k total：交换区总量
  - 4010444k used：使用的交换区量
  - 2870828k free：空闲的交换区量
  - 4336992k cached：缓冲交换区总量
- 再下面就是进程信息
  - PID：进程的ID
  - USER：进程所有者
  - PR：进程的优先级别，越小越优先被执行
  - NInice：值
  - VIRT：进程占用的虚拟内存
  - RES：进程占用的物理内存
  - SHR：进程使用的共享内存
  - S：进程的状态。S表示休眠，R表示正在运行，Z表示僵死状态，N表示该进程优先值为负数
  - %CPU：进程占用CPU的使用率
  - %MEM：进程使用的物理内存和总内存的百分比
  - TIME+：该进程启动后占用的总的CPU时间，即占用CPU使用时间的累加值。
  - COMMAND：进程启动命令名称

### 查看指定PID的进程

```
# 显示指定的进程信息
$ top -p pid

# 显示指定的进程下所有线程信息
$ top -Hp pid
```

你也可以在交互式模式下按 `k` 键，然后输入PID来实现同样的效果。

### 按照CPU使用率排序进程

```bash
$ top -o +%CPU
```

这个命令会按照CPU使用率从高到低排序进程，并显示进程列表。你也可以在交互式模式下按 `Shift+P` 键来实现同样的效果。

### 按照内存使用率排序进程

```bash
$ top -o +%MEM
```

这个命令会按照内存使用率从高到低排序进程，并显示进程列表。你也可以在交互式模式下按 `Shift+M` 键来实现同样的效果。

### 查看指定用户的进程

```bash
$ top -u dave
```

这个命令会只显示属于dave用户的进程，并显示进程列表。你也可以在交互式模式下按 `u` 键，然后输入用户名来实现同样的效果。

### 显示完整的程序命令

```
$ top -c
```

### 以批处理模式显示程序信息

```bash
$ top -b
```

### 设置信息更新次数

```
# 更新完10次后退出
top -n 10
```

### 设置信息更新周期

```
# 表示更新周期为3秒
$ top -d 3
```
